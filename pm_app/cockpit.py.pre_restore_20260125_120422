from dash import Dash, html, dcc
from datetime import datetime

app = Dash(__name__)
server = app.server

def kpi_card(title, value, subtitle=""):
    return html.Div(
        [
            html.Div(title, style={"fontSize":"12px","opacity":0.75}),
            html.Div(value, style={"fontSize":"28px","fontWeight":"700","marginTop":"6px"}),
            html.Div(subtitle, style={"fontSize":"12px","opacity":0.75,"marginTop":"6px"}),
        ],
        style={
            "border":"1px solid #ddd",
            "borderRadius":"14px",
            "padding":"14px",
            "boxShadow":"0 2px 10px rgba(0,0,0,0.06)",
            "background":"white",
        },
    )

app.layout = html.Div(
    style={"fontFamily":"Arial", "padding":"18px", "background":"#f6f7f9", "minHeight":"100vh"},
    children=[
        html.Div(
            [
                html.Div("Aion â€” Glass Cockpit", style={"fontSize":"22px","fontWeight":"700"}),
                html.Div(f"Last refresh: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}",
                         style={"opacity":0.7, "marginTop":"4px"}),
            ],
            style={"marginBottom":"14px"},
        ),

        html.Div(
            [
                kpi_card("Schedule Health", "GREEN", "No overdue milestones detected (placeholder)"),
                kpi_card("Scope Drift", "AMBER", "2 changes pending review (placeholder)"),
                kpi_card("Risk Register", "3 OPEN", "1 high / 2 medium (placeholder)"),
                kpi_card("Momentum", "OK", "Updates in last 7 days (placeholder)"),
            ],
            style={"display":"grid","gridTemplateColumns":"repeat(4, 1fr)","gap":"12px", "marginBottom":"14px"},
        ),

        html.Div(
            style={"display":"grid","gridTemplateColumns":"1.2fr 0.8fr","gap":"12px"},
            children=[
                html.Div(
                    [
                        html.Div("Exceptions / Alerts", style={"fontWeight":"700","marginBottom":"8px"}),
                        html.Ul(
                            [
                                html.Li("No owner assigned to 2 Epics (placeholder)"),
                                html.Li("1 Goal missing target date (placeholder)"),
                                html.Li("Charter last edited > 7 days ago (placeholder)"),
                            ],
                            style={"marginTop":"0"},
                        ),
                    ],
                    style={
                        "border":"1px solid #ddd","borderRadius":"14px","padding":"14px",
                        "boxShadow":"0 2px 10px rgba(0,0,0,0.06)","background":"white",
                    },
                ),
                html.Div(
                    [
                        html.Div("Quick Links", style={"fontWeight":"700","marginBottom":"8px"}),
                        dcc.Markdown(
                            "- PM System: http://127.0.0.1:8050/\n"
                            "- Docs: scope_contract.md\n"
                            "- Next: wire KPIs to charter_live.csv\n"
                        ),
                    ],
                    style={
                        "border":"1px solid #ddd","borderRadius":"14px","padding":"14px",
                        "boxShadow":"0 2px 10px rgba(0,0,0,0.06)","background":"white",
                    },
                ),
            ],
        ),
    ],
)

if __name__ == "__main__":
    # use_reloader=False prevents double-start behavior in debug
    app.run(host="127.0.0.1", port=8051, debug=True, use_reloader=False)
